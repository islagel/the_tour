---
title: "Shiny_Tour"
runtime: shiny
output: html_document
---

```{r, include  = FALSE}
library(tidyverse)

```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
top_tens <- as.tibble(readRDS("~/Mscs 264 F18/Submit Section B/TourProject/top_tens.rds"))
doping_tibble <- as.tibble(readRDS("~/Mscs 264 F18/Submit Section B/TourProject/doping_tibble.rds"))
tour_data <- as.tibble(readRDS("~/Mscs 264 F18/Submit Section B/TourProject/tour_data.rds"))
library(tidyverse)
library(maps)
```



```{r eruptions, echo=FALSE}
inputPanel(
  checkboxInput("doped", label = "Exclude Doped Winners",FALSE)
)

renderPlot({ 
WorldData <- map_data('world')
WorldData %>% filter(region != "Antarctica") -> WorldData
WorldData <- fortify(WorldData)

ggplot()+
  geom_map(data=WorldData, map=WorldData,
                  aes(x=long, y=lat, group=group, map_id=region),
                  fill="white", colour="#7f7f7f", size=0.5)+
  geom_map(data=a, map=WorldData,
                  aes(fill=n, map_id=Country),
                  colour="#7f7f7f", size=0.5)+
  theme_void()+
  scale_fill_continuous(low="thistle2", high="darkred", 
                               guide="colorbar")+
  labs(fill="legend", title="Number of Winners by Country", x="", y="")
 
})
```



```{r}

a <-  tour_data %>%
  left_join(doping_tibble, by = c("Cyclist" = "Name"))%>%
  mutate(Country = ifelse(Country=="United States", "USA", Country))%>%
  mutate(Country = ifelse(Country=="United Kingdom", "UK", Country)) %>%
  group_by(Country) %>%
  count() 
  

a
```

```{r tabsets, echo=FALSE}
shinyAppDir(
  system.file("examples/06_tabsets", package = "shiny"),
  options = list(
    width = "100%", height = 550
  )
)
```

Note the use of the `height` parameter to determine how much vertical space the embedded application should occupy.

You can also use the `shinyApp` function to define an application inline rather then in an external directory.

In all of R code chunks above the `echo = FALSE` attribute is used. This is to prevent the R code within the chunk from rendering in the document alongside the Shiny components.


##Barplot of Top Ten

```{r}
##top_tencomments <- read_csv("~/Mscs 264 F18/Submit Section B/Project/the_tour/top_tencomments.csv")
##Isaac
top_tencomments <- read_csv("~/Mscs 264 F18/Submit Section B/TourProject/top_tencomments.csv")

mergedtop_tens <- top_tens %>%
  mutate(Year = as.integer(Year)) %>%
  left_join(top_tencomments)


mergedtop_tens %>%
    ggplot(aes(x=Year, fill = Notes2)) +
    geom_bar(position = "fill")

```




