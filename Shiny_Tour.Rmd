---
title: "le Tour de France"
runtime: shiny
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(maps)
library(plotly)
knitr::opts_chunk$set(echo = TRUE)
top_tens <- as.tibble(readRDS("~/Mscs 264 F18/Submit Section B/TourProject/top_tens.rds"))
doping_tibble <- as.tibble(readRDS("~/Mscs 264 F18/Submit Section B/TourProject/doping_tibble.rds"))
tour_data <- as.tibble(readRDS("~/Mscs 264 F18/Submit Section B/TourProject/tour_data.rds"))


```



```{r , echo=FALSE}
inputPanel(
  checkboxInput("doped", label = "Exclude Doped Winners",FALSE)
)

renderPlot({ 
WorldData <- map_data('world')
WorldData %>% filter(region != "Antarctica") -> WorldData
WorldData <- fortify(WorldData)

a <-  if(input$doped){tour_data %>%
  left_join(doping_tibble, by = c("Cyclist" = "Name"))%>%
  filter(Status == "Never failed tests") %>%
  mutate(Country = ifelse(Country=="United States", "USA", Country))%>%
  mutate(Country = ifelse(Country=="United Kingdom", "UK", Country))%>%
  group_by(Country) %>%
  count()
  } else{
    tour_data %>%
  left_join(doping_tibble, by = c("Cyclist" = "Name"))%>%
  mutate(Country = ifelse(Country=="United States", "USA", Country))%>%
  mutate(Country = ifelse(Country=="United Kingdom", "UK", Country))%>%
  group_by(Country) %>%
  count()
  } 

ggplot()+
  geom_map(data=WorldData, map=WorldData,
                  aes(x=long, y=lat, group=group, map_id=region),
                  fill="white", colour="#7f7f7f", size=0.5)+
  geom_map(data=a, map=WorldData,
                  aes(fill=n, map_id=Country),
                  colour="#7f7f7f", size=0.5)+
  theme_void()+
  scale_fill_continuous(low="thistle2", high="darkred", 
                               guide="colorbar")+
  labs(fill="legend", title="Number of Winners by Country", x="", y="")
 
})
```



##Barplot of Top Ten

```{r}
##top_tencomments <- read_csv("~/Mscs 264 F18/Submit Section B/Project/the_tour/top_tencomments.csv")
##Isaac
top_tencomments <- read_csv("~/Mscs 264 F18/Submit Section B/TourProject/top_tencomments.csv")

mergedtop_tens <- top_tens %>%
  mutate(Year = as.integer(Year)) %>%
  left_join(top_tencomments)


mergedtop_tens %>%
    ggplot(aes(x=Year, fill = Notes2)) +
    geom_bar(position = "fill")

```




